SSLCertificateRequestMessage::SSLCertificateRequestMessage(uint8_t* data, size_t dataLen, SSLHandshakeLayer* container)
		: SSLHandshakeMessage(data, dataLen, container)
{
	if (dataLen < sizeof(ssl_tls_handshake_layer) +
			sizeof(uint8_t)) // certificate types count (1B)
		return;

	size_t messageLen = getMessageLength();

	uint8_t certificateTypesCount = *(uint8_t*)(data + sizeof(ssl_tls_handshake_layer));

	if (certificateTypesCount > messageLen - sizeof(ssl_tls_handshake_layer) - sizeof(uint8_t))
		certificateTypesCount = messageLen - sizeof(ssl_tls_handshake_layer) - sizeof(uint8_t);

	uint8_t* pos = data + sizeof(ssl_tls_handshake_layer) + sizeof(uint8_t);
	for (uint8_t i = 0; i < certificateTypesCount; i++)
	{
		uint8_t certType = *(uint8_t*)(pos + i);
		if (certType == 0 ||
				(certType > 6 && certType < 20) ||
				(certType > 20 && certType < 64) ||
				certType > 64)
			m_ClientCertificateTypes.push_back(SSL_CCT_UNKNOWN);
		else
			m_ClientCertificateTypes.push_back(static_cast<SSLClientCertificateType>(certType));
	}
}